{"version":3,"file":"leaflet.directive.js","sources":["../../../src/leaflet/core/leaflet.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n\tDirective, ElementRef, EventEmitter, HostListener, Input, NgZone, OnChanges, OnInit, Output,\n\tSimpleChange\n} from '@angular/core';\n\nimport { latLng, LatLng, LatLngBounds, map, Map, MapOptions} from 'leaflet';\n\n@Directive({\n\tselector: '[leaflet]'\n})\nexport class LeafletDirective\n\timplements OnChanges, OnInit {\n\n\treadonly DEFAULT_ZOOM = 1;\n\treadonly DEFAULT_CENTER = latLng(38.907192, -77.036871);\n\treadonly DEFAULT_FPZ_OPTIONS = {};\n\n\tresizeTimer: any;\n\n\t// Reference to the primary map object\n\tmap: Map;\n\n\t@Input('leafletFitBoundsOptions') fitBoundsOptions = this.DEFAULT_FPZ_OPTIONS;\n\t@Input('leafletPanOptions') panOptions = this.DEFAULT_FPZ_OPTIONS;\n\t@Input('leafletZoomOptions') zoomOptions = this.DEFAULT_FPZ_OPTIONS;\n\t@Input('leafletZoomPanOptions') zoomPanOptions = this.DEFAULT_FPZ_OPTIONS;\n\n\n\t// Default configuration\n\t@Input('leafletOptions') options: MapOptions = {};\n\n\t// Configure callback function for the map\n\t@Output('leafletMapReady') mapReady = new EventEmitter<Map>();\n\n\t// Zoom level for the map\n\t@Input('leafletZoom') zoom: number;\n\n\t// Center the map\n\t@Input('leafletCenter') center: LatLng;\n\n\t// Set fit bounds for map\n\t@Input('leafletFitBounds') fitBounds: LatLngBounds;\n\n\n\tconstructor(private element: ElementRef, private zone: NgZone) {\n\t\t// Nothing here\n\t}\n\n\tngOnInit() {\n\n\t\t// Create the map with some reasonable defaults\n\t\tthis.zone.runOutsideAngular(() => {\n\t\t\tthis.map = map(this.element.nativeElement, this.options);\n\t\t});\n\n\t\t// Only setView if there is a center/zoom\n\t\tif (null != this.center && null != this.zoom) {\n\t\t\tthis.setView(this.center, this.zoom);\n\t\t}\n\n\t\t// Set up all the initial settings\n\t\tif (null != this.fitBounds) {\n\t\t\tthis.setFitBounds(this.fitBounds);\n\t\t}\n\n\t\tthis.doResize();\n\n\t\t// Fire map ready event\n\t\tthis.mapReady.emit(this.map);\n\n\t}\n\n\tngOnChanges(changes: { [key: string]: SimpleChange }) {\n\n\t\t/*\n\t\t * The following code is to address an issue with our (basic) implementation of\n\t\t * zooming and panning. From our testing, it seems that a pan operation followed\n\t\t * by a zoom operation in the same thread will interfere with eachother. The zoom\n\t\t * operation interrupts/cancels the pan, resulting in a final center point that is\n\t\t * inaccurate. The solution seems to be to either separate them with a timeout or\n\t\t  * to collapse them into a setView call.\n\t\t */\n\n\t\t// Zooming and Panning\n\t\tif (changes['zoom'] && changes['center'] && null != this.zoom && null != this.center) {\n\t\t\tthis.setView(changes['center'].currentValue, changes['zoom'].currentValue);\n\t\t}\n\t\t// Set the zoom level\n\t\telse if (changes['zoom']) {\n\t\t\tthis.setZoom(changes['zoom'].currentValue);\n\t\t}\n\t\t// Set the map center\n\t\telse if (changes['center']) {\n\t\t\tthis.setCenter(changes['center'].currentValue);\n\t\t}\n\n\t\t// Fit bounds\n\t\tif (changes['fitBounds']) {\n\t\t\tthis.setFitBounds(changes['fitBounds'].currentValue);\n\t\t}\n\n\t}\n\n\tpublic getMap() {\n\t\treturn this.map;\n\t}\n\n\n\t@HostListener('window:resize', [])\n\tonResize() {\n\t\tthis.delayResize();\n\t}\n\n\t/**\n\t * Resize the map to fit it's parent container\n\t */\n\tprivate doResize() {\n\n\t\t// Invalidate the map size to trigger it to update itself\n\t\tthis.zone.runOutsideAngular(() => {\n\t\t\tthis.map.invalidateSize({});\n\t\t});\n\n\t}\n\n\t/**\n\t * Manage a delayed resize of the component\n\t */\n\tprivate delayResize() {\n\t\tif (null != this.resizeTimer) {\n\t\t\tclearTimeout(this.resizeTimer);\n\t\t}\n\t\tthis.resizeTimer = setTimeout(this.doResize.bind(this), 200);\n\t}\n\n\n\t/**\n\t * Set the view (center/zoom) all at once\n\t * @param center The new center\n\t * @param zoom The new zoom level\n\t */\n\tprivate setView(center: LatLng, zoom: number) {\n\n\t\tif (this.map && null != center && null != zoom) {\n\t\t\tthis.zone.runOutsideAngular(() => {\n\t\t\t\tthis.map.setView(center, zoom, this.zoomPanOptions);\n\t\t\t});\n\t\t}\n\n\t}\n\n\t/**\n\t * Set the map zoom level\n\t * @param zoom the new zoom level for the map\n\t */\n\tprivate setZoom(zoom: number) {\n\n\t\tif (this.map && null != zoom) {\n\t\t\tthis.zone.runOutsideAngular(() => {\n\t\t\t\tthis.map.setZoom(zoom, this.zoomOptions);\n\t\t\t});\n\t\t}\n\n\t}\n\n\t/**\n\t * Set the center of the map\n\t * @param center the center point\n\t */\n\tprivate setCenter(center: LatLng) {\n\n\t\tif (this.map && null != center) {\n\t\t\tthis.zone.runOutsideAngular(() => {\n\t\t\t\tthis.map.panTo(center, this.panOptions);\n\t\t\t});\n\t\t}\n\n\t}\n\n\t/**\n\t * Fit the map to the bounds\n\t * @param center the center point\n\t */\n\tprivate setFitBounds(latLngBounds: LatLngBounds) {\n\n\t\tif (this.map && null != latLngBounds) {\n\t\t\tthis.zone.runOutsideAngular(() => {\n\t\t\t\tthis.map.fitBounds(latLngBounds, this.fitBoundsOptions);\n\t\t\t});\n\t\t}\n\n\t}\n}\n"]}